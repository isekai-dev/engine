'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var isekai = _interopDefault(require('isekai'));
var express = _interopDefault(require('express'));
var fs = _interopDefault(require('fs'));
var https = _interopDefault(require('https'));
var http = _interopDefault(require('http'));

var LOG_equip = ({
    LOG: {
        left = `|⚙>`,
        right = `<⚙|`
    },
    SET
}) => {
    const LOG = {
        left,
        right,

        log: (...args) => {
            console.log(`\t`, ...args);
        },

        info: (...args) => {
            console.log(LOG.left, `\t`, ...args, `\t`, LOG.right);
        },

        section: (title, body) => {
            LOG.info(title);
            LOG(body);
            LOG(`\r`);
        }
    };

    SET({
        LOG: Object.assign(LOG.log, LOG)
    });
};

var HTTP = ({
    LOG,
    HTTP: {
        ssl = false
    },
    SET, 
    EQUIP
}) => {
    const app = express();

    if(!LOG) {
        console.log(`EQUIPING LOG`);
        EQUIP({
            LOG: LOG_equip
        });
    }

    if(ssl) {
        https.createServer({
            key: fs.readFileSync(`${ssl}/privkey.pem`),
            cert: fs.readFileSync(`${ssl}/cert.pem`),
            ca: fs.readFileSync(`${ssl}/fullchain.pem`)
        }, app).
            listen(443, () => {
                LOG.info(`[HTTPS]`);
                LOG(`BIFROST SECURED`);
            });

        const redirectApp = express();
    
        LOG(`Redirecting to HTTP to HTTPS`);

        redirectApp.all(`*`, (req, res) => {  
            res.redirect(`https://${req.headers.host}${req.url}`);
            res.end();
        });

        http.createServer(redirectApp).
            listen(80);

    } else {
        app.listen(8080, () => {
            LOG.info(`⚠️[HTTP]⚠️`);
            LOG(`BIFROST INSECURE`);
            LOG(`Listening on port 8080`);
        });
    }
    
    SET({
        HTTP: {
            app
        }
    });
};

var HTTP_API = ({ 
    HTTP,
    SET
}) => {
    SET({
        HTTP_API: HTTP.use(express.json())
    });
};

var HTTP_PUBLIC = ({
    HTTP
}) => {
    HTTP.use(express.static(`../BAG/HTTP_PUBLIC`));
};

isekai.SET({"NODE":{},"HTTP":{"port":8080},"HTTP_API":{},"HTTP_PUBLIC":{}});

isekai.EQUIP({
    HTTP,
    HTTP_API,
    HTTP_PUBLIC,
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaXNla2FpX2Rldi5OT0RFLmpzIiwic291cmNlcyI6WyIuLi9TSE9QL0xPRy9pbmRleC5qcyIsIi4uL1NIT1AvSFRUUC9pbmRleC5qcyIsIi4uL1NIT1AvSFRUUF9BUEkvaW5kZXguanMiLCIuLi9TSE9QL0hUVFBfUFVCTElDL2luZGV4LmpzIiwiaXNla2FpX2Rldi5lbnRyeS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCAoe1xyXG4gICAgTE9HOiB7XHJcbiAgICAgICAgbGVmdCA9IGB84pqZPmAsXHJcbiAgICAgICAgcmlnaHQgPSBgPOKamXxgXHJcbiAgICB9LFxyXG4gICAgU0VUXHJcbn0pID0+IHtcclxuICAgIGNvbnN0IExPRyA9IHtcclxuICAgICAgICBsZWZ0LFxyXG4gICAgICAgIHJpZ2h0LFxyXG5cclxuICAgICAgICBsb2c6ICguLi5hcmdzKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBcXHRgLCAuLi5hcmdzKTtcclxuICAgICAgICB9LFxyXG5cclxuICAgICAgICBpbmZvOiAoLi4uYXJncykgPT4ge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhMT0cubGVmdCwgYFxcdGAsIC4uLmFyZ3MsIGBcXHRgLCBMT0cucmlnaHQpO1xyXG4gICAgICAgIH0sXHJcblxyXG4gICAgICAgIHNlY3Rpb246ICh0aXRsZSwgYm9keSkgPT4ge1xyXG4gICAgICAgICAgICBMT0cuaW5mbyh0aXRsZSk7XHJcbiAgICAgICAgICAgIExPRyhib2R5KTtcclxuICAgICAgICAgICAgTE9HKGBcXHJgKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIFNFVCh7XHJcbiAgICAgICAgTE9HOiBPYmplY3QuYXNzaWduKExPRy5sb2csIExPRylcclxuICAgIH0pO1xyXG59OyIsIlxyXG5pbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5pbXBvcnQgZnMgZnJvbSBcImZzXCI7XHJcblxyXG5pbXBvcnQgaHR0cHMgZnJvbSBcImh0dHBzXCI7XHJcbmltcG9ydCBodHRwIGZyb20gXCJodHRwXCI7XHJcbmltcG9ydCBMT0dfZXF1aXAgZnJvbSBcIi4uL0xPRy9pbmRleC5qc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHtcclxuICAgIExPRyxcclxuICAgIEhUVFA6IHtcclxuICAgICAgICBzc2wgPSBmYWxzZVxyXG4gICAgfSxcclxuICAgIFNFVCwgXHJcbiAgICBFUVVJUFxyXG59KSA9PiB7XHJcbiAgICBjb25zdCBhcHAgPSBleHByZXNzKCk7XHJcblxyXG4gICAgaWYoIUxPRykge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBFUVVJUElORyBMT0dgKTtcclxuICAgICAgICBFUVVJUCh7XHJcbiAgICAgICAgICAgIExPRzogTE9HX2VxdWlwXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYoc3NsKSB7XHJcbiAgICAgICAgaHR0cHMuY3JlYXRlU2VydmVyKHtcclxuICAgICAgICAgICAga2V5OiBmcy5yZWFkRmlsZVN5bmMoYCR7c3NsfS9wcml2a2V5LnBlbWApLFxyXG4gICAgICAgICAgICBjZXJ0OiBmcy5yZWFkRmlsZVN5bmMoYCR7c3NsfS9jZXJ0LnBlbWApLFxyXG4gICAgICAgICAgICBjYTogZnMucmVhZEZpbGVTeW5jKGAke3NzbH0vZnVsbGNoYWluLnBlbWApXHJcbiAgICAgICAgfSwgYXBwKS5cclxuICAgICAgICAgICAgbGlzdGVuKDQ0MywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgTE9HLmluZm8oYFtIVFRQU11gKTtcclxuICAgICAgICAgICAgICAgIExPRyhgQklGUk9TVCBTRUNVUkVEYCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCByZWRpcmVjdEFwcCA9IGV4cHJlc3MoKTtcclxuICAgIFxyXG4gICAgICAgIExPRyhgUmVkaXJlY3RpbmcgdG8gSFRUUCB0byBIVFRQU2ApO1xyXG5cclxuICAgICAgICByZWRpcmVjdEFwcC5hbGwoYCpgLCAocmVxLCByZXMpID0+IHsgIFxyXG4gICAgICAgICAgICByZXMucmVkaXJlY3QoYGh0dHBzOi8vJHtyZXEuaGVhZGVycy5ob3N0fSR7cmVxLnVybH1gKTtcclxuICAgICAgICAgICAgcmVzLmVuZCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBodHRwLmNyZWF0ZVNlcnZlcihyZWRpcmVjdEFwcCkuXHJcbiAgICAgICAgICAgIGxpc3Rlbig4MCk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBhcHAubGlzdGVuKDgwODAsICgpID0+IHtcclxuICAgICAgICAgICAgTE9HLmluZm8oYOKaoO+4j1tIVFRQXeKaoO+4j2ApO1xyXG4gICAgICAgICAgICBMT0coYEJJRlJPU1QgSU5TRUNVUkVgKTtcclxuICAgICAgICAgICAgTE9HKGBMaXN0ZW5pbmcgb24gcG9ydCA4MDgwYCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIFNFVCh7XHJcbiAgICAgICAgSFRUUDoge1xyXG4gICAgICAgICAgICBhcHBcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufTsiLCJcclxuaW1wb3J0IGV4cHJlc3MgZnJvbSBcImV4cHJlc3NcIjtcclxuXHJcbmV4cG9ydCBkZWZhdWx0ICh7IFxyXG4gICAgSFRUUCxcclxuICAgIFNFVFxyXG59KSA9PiB7XHJcbiAgICBTRVQoe1xyXG4gICAgICAgIEhUVFBfQVBJOiBIVFRQLnVzZShleHByZXNzLmpzb24oKSlcclxuICAgIH0pO1xyXG59O1xyXG4iLCJpbXBvcnQgZXhwcmVzcyBmcm9tIFwiZXhwcmVzc1wiO1xyXG5cclxuZXhwb3J0IGRlZmF1bHQgKHtcclxuICAgIEhUVFBcclxufSkgPT4ge1xyXG4gICAgSFRUUC51c2UoZXhwcmVzcy5zdGF0aWMoYC4uL0JBRy9IVFRQX1BVQkxJQ2ApKTtcclxufTtcclxuXHJcbiIsImltcG9ydCBpc2VrYWkgZnJvbSBcImlzZWthaVwiO1xyXG5pc2VrYWkuU0VUKHtcIk5PREVcIjp7fSxcIkhUVFBcIjp7XCJwb3J0XCI6ODA4MH0sXCJIVFRQX0FQSVwiOnt9LFwiSFRUUF9QVUJMSUNcIjp7fX0pO1xyXG5cclxuaW1wb3J0IEhUVFAgZnJvbSBcIi4uL1NIT1AvSFRUUC9pbmRleC5qc1wiO1xyXG5pbXBvcnQgSFRUUF9BUEkgZnJvbSBcIi4uL1NIT1AvSFRUUF9BUEkvaW5kZXguanNcIjtcclxuaW1wb3J0IEhUVFBfUFVCTElDIGZyb20gXCIuLi9TSE9QL0hUVFBfUFVCTElDL2luZGV4LmpzXCI7XHJcblxuaXNla2FpLkVRVUlQKHtcclxuICAgIEhUVFAsXHJcbiAgICBIVFRQX0FQSSxcclxuICAgIEhUVFBfUFVCTElDLFxyXG59KTtcclxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBQSxnQkFBZSxDQUFDO0lBQ1osR0FBRyxFQUFFO1FBQ0QsSUFBSSxHQUFHLENBQUMsR0FBRyxDQUFDO1FBQ1osS0FBSyxHQUFHLENBQUMsR0FBRyxDQUFDO0tBQ2hCO0lBQ0QsR0FBRztDQUNOLEtBQUs7SUFDRixNQUFNLEdBQUcsR0FBRztRQUNSLElBQUk7UUFDSixLQUFLOztRQUVMLEdBQUcsRUFBRSxDQUFDLEdBQUcsSUFBSSxLQUFLO1lBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDOUI7O1FBRUQsSUFBSSxFQUFFLENBQUMsR0FBRyxJQUFJLEtBQUs7WUFDZixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxHQUFHLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN6RDs7UUFFRCxPQUFPLEVBQUUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxLQUFLO1lBQ3RCLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDaEIsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ1YsR0FB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
